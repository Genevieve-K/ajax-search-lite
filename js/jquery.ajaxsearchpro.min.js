(function(e){function n(){return!!("ontouchstart"in window)?1:0}var t={init:function(r){var i=e.extend({},this,t);i.searching=false;i.o=e.extend({},r);i.n=new Object;i.n.container=e(this);i.n.probox=e(".probox",this);i.n.proinput=e(".proinput",this);i.n.text=e(".proinput input",this);i.n.loading=e(".proinput .loading",this);i.n.proloading=e(".proloading",this);i.n.promagnifier=e(".promagnifier",this);i.n.prosettings=e(".prosettings",this);i.n.searchsettings=e(".searchsettings",this);i.n.resultsDiv=e(this).next();i.n.items=e(".item",i.n.resultsDiv);i.n.results=e(".results",i.n.resultsDiv);i.n.resdrg=e(".resdrg",i.n.resultsDiv);i.n.drag=e(".resdrg",i.n.resultsDiv);i.o.id=i.n.container.attr("id").match(/^ajaxsearchpro(.*)/)[1];i.cleanUp();i.n.resultsDiv.appendTo("body");i.n.searchsettings.appendTo("body");if(e.browser.msie&&e.browser.version<9){i.n.searchsettings.addClass("ie78")}i.n.resultsDiv.css({opacity:0});e(document).bind("click",function(){i.hideResults();i.hideSettings()});e(this).bind("click",function(e){e.stopImmediatePropagation()});i.n.resultsDiv.bind("click",function(e){e.stopImmediatePropagation()});i.n.searchsettings.bind("click",function(e){e.stopImmediatePropagation()});i.scroll=i.n.results.mCustomScrollbar({scrollButtons:{enable:true,scrollType:"pixels",scrollSpeed:parseInt(i.o.resultitemheight),scrollAmount:parseInt(i.o.resultitemheight)},callbacks:{onScroll:function(){if(n())return;var t=parseInt(e(".mCSB_container",i.n.results).position().top);scr=t%(i.o.resultitemheight+3)-t==0&&Math.abs(t)%(i.o.resultitemheight+3)<i.o.resultitemheight/2+3?"first":-(Math.abs(t)%(i.o.resultitemheight+3))-t;if(Math.abs(t)%(i.o.resultitemheight+3)>i.o.resultitemheight/2){if(scr!="first")scr+=i.o.resultitemheight+3;e(".mCSB_container",i.n.resultsDiv).animate({top:-scr})}else{e(".mCSB_container",i.n.resultsDiv).animate({top:-scr})}}}});i.n.prosettings.click(function(){if(i.n.prosettings.attr("opened")==0){i.showSettings()}else{i.hideSettings()}});var s;e(window).bind("resize",function(){i.resize()});e(window).bind("scroll",function(){i.scrolling(false)});e(window).trigger("resize");e(window).trigger("scroll");i.n.promagnifier.click(function(){clearTimeout(s);s=setTimeout(function(){i.search();s=null},700)});i.n.text.keyup(function(){i.n.promagnifier.trigger("click")});return i},destroy:function(){return this.each(function(){var n=e.extend({},this,t);e(window).unbind(n)})},searchfor:function(t){e(".proinput input",this).val(t).trigger("keyup")},search:function(){var n=e.extend({},this,t);if(n.searching&&0)return;if(n.n.text.val().length<n.o.charcount)return;n.searching=true;n.n.proloading.css({visibility:"visible"});n.hideSettings();n.hideResults();var r={action:"ajaxsearchpro_search",s:n.n.text.val(),id:n.o.id,options:e("form",n.n.searchsettings).serialize()};jQuery.post(ajaxsearchpro.ajaxurl,r,function(t){n.n.resdrg.html("");if(t.nores!=null&&t.keywords!=null){var r=n.o.noresultstext+" "+n.o.didyoumeantext+"<br>";for(var i=0;i<t.keywords.length;i++){r=r+"<span class='keyword'>"+t.keywords[i]+"</span>"}n.n.resdrg.append("<div class='nores'>"+r+"</div>");e(".keyword",n.n.resdrg).bind("click",function(){n.n.text.val(e(this).html());n.n.promagnifier.trigger("click")})}else if(t.length>0){for(var i=0;i<t.length;i++){var s="";var o="";var u="";var a="";if(t[i].image!=null&&t[i].image!=""){s="                       <div class='image' style='width:"+n.o.imagewidth+"px;height:"+n.o.imageheight+"px;'>                        <img src='"+t[i].image+"'>                         </div>"}if(n.o.showauthor==1){u="<span class='author'>"+t[i].author+"</span>"}if(n.o.showdate==1){a="<span class='date'>"+t[i].date+"</span>"}if(n.o.showdescription==1){o=t[i].content}var f="item_"+n.o.id+"_"+i;var l="";if(n.o.resultareaclickable==1){l="<span class='overlap'></span>"}var c="                     <div class='item' id='"+f+"' style='height:"+n.o.resultitemheight+"px;'>                       "+s+"                       <div class='content' style='height:"+n.o.resultitemheight+"px;'>                         <h3><a href='"+t[i].link+"'>"+t[i].title+l+"</a></h3>                                   <div class='etc'>"+u+"                                 "+a+"</div>                         <p class='desc'>"+o+"</p>                              </div>                           <div class='clear'></div>                        </div>";c=e(c);n.n.resdrg.append(c)}}else{n.n.resdrg.append("<div class='nores'>"+n.o.noresultstext+"</div>")}n.n.items=e(".item",n.n.resultsDiv);n.showResults();n.n.proloading.css({visibility:"hidden"})},"json")},showResults:function(){var n=e.extend({},this,t);n.scrolling(true);var r=n.n.resultsDiv.position().top;n.n.resultsDiv.css({top:r-100,opacity:0,visibility:"visible"}).animate({top:r,opacity:1});if(n.n.items.length>0){var i=n.n.items.length<n.o.itemscount?n.n.items.length:n.o.itemscount;n.n.results.css({height:i*n.n.items.outerHeight(true)+3});n.scroll.mCustomScrollbar("update");n.scroll.mCustomScrollbar("scrollTo","first",{callback:false});if(n.o.highlight==1){var s=n.o.highlightwholewords==1?true:false;n.n.resultsDiv.highlight(n.n.text.val().split(" "),{element:"span",className:"highlighted",wordsOnly:s})}}n.resize();if(n.n.items.length==0){var o=e(".nores",n.n.results).outerHeight(true)>n.o.resultitemheight?n.o.resultitemheight:e(".nores",n.n.results).outerHeight(true);n.n.results.css({height:11110});n.scroll.mCustomScrollbar("update");n.n.results.css({height:e(".nores",n.n.results).outerHeight(true)})}n.scrolling(true);n.searching=false},hideResults:function(){var n=e.extend({},this,t);n.n.resultsDiv.animate({opacity:0},{complete:function(){e(this).css({visibility:"hidden"})}})},showSettings:function(){var n=e.extend({},this,t);n.scrolling(true);n.n.searchsettings.css({opacity:0,visibility:"visible",top:"-=50px"});n.n.searchsettings.animate({opacity:1,top:"+=50px"});n.n.prosettings.attr("opened",1)},hideSettings:function(){var n=e.extend({},this,t);n.n.searchsettings.animate({opacity:0},{complete:function(){e(this).css({visibility:"hidden"})}});n.n.prosettings.attr("opened",0)},cleanUp:function(){var n=e.extend({},this,t);e("body>#ajaxsearchprosettings"+n.o.id).remove();e("body>#ajaxsearchprores"+n.o.id).remove()},resize:function(){var n=e.extend({},this,t);n.n.proinput.css({width:n.n.probox.width()-8-(n.n.proinput.outerWidth()-n.n.proinput.width())-n.n.proloading.outerWidth(true)-n.n.prosettings.outerWidth(true)-n.n.promagnifier.outerWidth(true)-10});if(n.n.prosettings.attr("opened")!=0){n.n.searchsettings.css({display:"block",top:n.n.prosettings.offset().top+n.n.prosettings.height()-2,left:n.n.prosettings.offset().left+n.n.prosettings.width()-n.n.searchsettings.width()})}if(n.n.resultsDiv.css("visibility")!="hidden"){n.n.resultsDiv.css({width:n.n.container.width()-(n.n.resultsDiv.outerWidth(true)-n.n.resultsDiv.width()),top:n.n.container.offset().top+n.n.container.outerHeight(true)+10,left:n.n.container.offset().left});e(".content",n.n.items).each(function(){var t=e(this).prev().css("display")=="none"?0:e(this).prev().outerWidth(true);e(this).css({width:e(this.parentNode).width()-e(this).prev().outerWidth(true)-e(this).outerWidth()+e(this).width()})})}},scrolling:function(n){var r=e.extend({},this,t);if(n==true||r.n.searchsettings.css("visibility")=="visible"){r.n.searchsettings.css({display:"block",top:r.n.prosettings.offset().top+r.n.prosettings.height()-2,left:r.n.prosettings.offset().left+r.n.prosettings.width()-r.n.searchsettings.width()})}if(n==true||r.n.resultsDiv.css("visibility")=="visible"){r.n.resultsDiv.css({width:r.n.container.width()-(r.n.resultsDiv.outerWidth(true)-r.n.resultsDiv.width()),top:r.n.container.offset().top+r.n.container.outerHeight(true)+10,left:r.n.container.offset().left});e(".content",r.n.items).each(function(){var t=e(this).prev().css("display")=="none"?0:e(this).prev().outerWidth(true);e(this).css({width:e(this.parentNode).width()-e(this).prev().outerWidth(true)-e(this).outerWidth()+e(this).width()})})}}};e.fn.ajaxsearchpro=function(n){if(t[n]){return t[n].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof n==="object"||!n){return t.init.apply(this,arguments)}else{e.error("Method "+n+" does not exist on jQuery.ajaxsearchpro")}}})(jQuery)